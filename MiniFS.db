create database minifs;

use minifs;

CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    role ENUM('admin','user') NOT NULL
);

CREATE TABLE nodes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    type ENUM('file','directory') NOT NULL,
    content TEXT NULL,

    owner INT NOT NULL,
    parent INT NULL,

    FOREIGN KEY (owner) REFERENCES users(id),
    FOREIGN KEY (parent) REFERENCES nodes(id) ON DELETE CASCADE
);

CREATE TABLE commands_log (
    id INT AUTO_INCREMENT PRIMARY KEY,
    command TEXT NOT NULL,
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
    user_id INT NOT NULL,
    FOREIGN KEY (user_id) REFERENCES users(id)
);


INSERT INTO users (username, password, role)
VALUES ('admin', 'admin123', 'admin');

INSERT INTO nodes (name, type, content, owner, parent)
VALUES ('/', 'directory', NULL, 1, NULL); -- id = 1

INSERT INTO nodes (name, type, content, owner, parent)
VALUES ('system', 'directory', NULL, 1, 1); -- id = 2

INSERT INTO nodes (name, type, content, owner, parent)
VALUES ('manual.txt', 'file',
'MiniFS User Manual
------------------
Available Commands:
  ls       - list directory
  cd       - change directory
  mkdir    - create a directory
  rmdir    - remove an empty directory
  touch    - create a new text file
  rm       - delete a file
  cat      - display a file
  echo     - write text into a file
', 1, 2);

INSERT INTO nodes (name, type, content, owner, parent)
VALUES ('workspace', 'directory', NULL, 1, 1); -- id = 4

INSERT INTO nodes (name, type, content, owner, parent)
VALUES ('personal', 'directory', NULL, 1, 4);

INSERT INTO nodes (name, type, content, owner, parent)
VALUES ('work', 'directory', NULL, 1, 4);

INSERT INTO nodes (name, type, content, owner, parent)
VALUES ('notes', 'directory', NULL, 1, 4);

INSERT INTO nodes (name, type, content, owner, parent)
VALUES ('logs', 'directory', NULL, 1, 1); -- id = 8

INSERT INTO nodes (name, type, content, owner, parent)
VALUES ('logs.txt', 'file', '', 1, 8);
